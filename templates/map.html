<html>
  <head>
    <meta charset=utf-8 />
<title>Multi-Stop Transit Routing</title>
    <link href='http://api.tiles.mapbox.com/mapbox.js/v1.2.0/mapbox.css' rel='stylesheet' />
    <script src='http://api.tiles.mapbox.com/mapbox.js/v1.2.0/mapbox.js'></script>
    <style>
      #map { position:absolute; top:0; bottom:0; left:0; width:100%; }
    </style>
  </head>
  
  <body>

    <style>
      pre.pointA-coordinates {
        position:absolute;
        bottom:20px;
        left:30px;
        padding:5px 10px;
        background:rgba(0,0,0,0.5);
        color:#fff;
        font-size:13px;
        line-height:18px;
        border-radius:3px;
        }
      pre.pointB-coordinates2 {
        position:absolute;
        bottom:20px;
        left:300px;
        padding:5px 10px;
        background:rgba(0,0,0,0.5);
        color:#fff;
        font-size:13px;
        line-height:18px;
        border-radius:3px;
        }

        .ui-button {
          background:#3887BE;
          color:#FFF;
          display:block;
          position:absolute;
          top:20%;left:15%;
          width:130px;
          margin:-20px 0 0 -80px;
          z-index:100;
          text-align:center;
          padding:10px;
          border:0px solid rgba(0,0,0,0.4);
          border-radius:3px;
          }
        
        .ui-button:hover {
          background:#3074a4;
          color:#fff;
          }
    </style>

    <div id='map'></div>
    <a class='ui-button'>Find route</a>
    <pre id='coordinates' class='pointA-coordinates'></pre>
    <pre id='coordinates2' class='pointB-coordinates2'></pre>

    
    <script type='text/javascript'>
      
      var map = L.mapbox.map('map', 'meghan.ipb4b059', {
        gridLayer: {},
        gridControl: {
        sanitizer: function(x) { console.log(x); return x; }
        }
        })
        .setView([45.52282, -122.6766], 13);
        
      var marker = L.marker(new L.LatLng(45.52282, -122.6766), {
        icon: L.mapbox.marker.icon({'marker-color': 'CC0033'}),
        draggable: true
        }).addTo(map);

      var marker2 = L.marker(new L.LatLng(45.52282, -122.69), {
        icon: L.mapbox.marker.icon({'marker-color': 'CC0033'}),
        draggable: true
        }).addTo(map);

    
      markerLocation();

      markerLocation2();

    
      marker.on('dragend', markerLocation);

      marker2.on('dragend', markerLocation2); 

      function markerLocation() {
          var m = marker.getLatLng();
          coordinates.innerHTML = 'POINT A <br>Latitude: ' + m.lat + '<br />Longitude: ' + m.lng;
      };

      function markerLocation2() {
          var l = marker2.getLatLng();
          coordinates2.innerHTML = 'POINT B <br>Latitude: ' + l.lat + '<br />Longitude: ' + l.lng;
      };

      function generate_url () {
        var point_a = marker.getLatLng();
        var point_b = marker2.getLatLng();

        url = "http://localhost:8080/otp/routers/default/plan?fromPlace="+point_a+"&toPlace="+point_b+"&time=3%3A20pm&date=07-18-2014&mode=TRANSIT%2CWALK&maxWalkDistance=750&arriveBy=false&showIntermediateStops=false"
      //   //takes coordinates, formulates url


      //   // example url: http://localhost:8080/otp/routers/default/plan?fromPlace=45.520300607576864%2C-122.65514373779297&toPlace=45.50562506354086%2C-122.63557434082031&time=3%3A20pm&date=07-16-2014&mode=TRANSIT%2CWALK&maxWalkDistance=750&arriveBy=false&showIntermediateStops=false

      // }

      function get_routes () {
        var url = generate_url();
        // put ajax request formulation here, using jquery
        // send ajax request to 8080, using full url for OTP
      
        $.get(url, map_route(path_data))
      }
      
      $(document).ready(function () {
        $(".ui-button").click(function (path_data){

          get_routes(path_data)
          alert( "Load was performed." )
          console.log("Success")
          console.log(path_data)

        });

      // function map_route (path_data) {
      //   // js function that uses path_data json to render route polyline


      // }

      }


    </script>
  </body>
</html>